"use strict";var vm=Vue.createApp({data:function(){return{chatlist:[],connectionid:null,signalRconnect:null,nowtalkid:null,talklist:[],nowtalk:[],keyonmessage:"",config:window.appSettings}},created:function(){var n=this;n.signalRconnect=(new signalR.HubConnectionBuilder).withUrl(n.config.ChatHubUrl).withAutomaticReconnect().build();n.initSigmalR(n)},methods:{initSigmalR:function(){var n=arguments.length<=0||arguments[0]===undefined?this:arguments[0];return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(n.signalRconnect.start().then(function(){n.connectionid=n.signalRconnect.connectionId;console.log("SignalR 连接已建立")})["catch"](function(n){console.error("SignalR 连接失败:",n)}));case 2:n.signalRconnect.on("OnlineList",function(t){n.chatlist=t});n.signalRconnect.on("UserConnected",function(t){t.connectionID!=n.connectionid&&n.chatlist.push(t)});n.signalRconnect.on("UserDisconnected",function(t){var r=n.chatlist,i=_.find(r,function(n){return n.connectionID==t});i!=null&&i!==undefined&&(n.chatlist=_.filter(r,function(n){return n.connectionID!=i.connectionID}));n.nowtalkid==t&&n.talkselect(null)});n.signalRconnect.on("PrivateMessage",function(t,i){var u=n.chatlist,r=_.find(u,function(n){return n.connectionID==t.connectionID});r==null||r==undefined?(t.lastMesage=i,n.chatlist.push(t)):(n.nowtalkid!=r.connectionID&&(r.noReadCount=r.noReadCount+1),r.lastMesage=i);n.addTalk(t.connectionID,t.connectionID,i);(n.nowtalkid==null||n.nowtalkid==undefined)&&n.talkselect(t.connectionID)});case 6:case"end":return t.stop()}},null,this)},talkselect:function(n){this.nowtalkid=n;var i=this.chatlist,t=_.find(i,function(t){return t.connectionID==n});t!=null&&t!=undefined&&t.noReadCount>0&&(t.noReadCount=0);this.refreshChat()},sendmessage:function(){var t=this.chatlist,i=this.nowtalkid,n;this.isWhiteSpace(this.keyonmessage)||(this.signalRconnect.invoke("PrivateMessage",this.nowtalkid,this.keyonmessage)["catch"](function(n){alert("傳送錯誤: "+n.toString());return}),n=_.find(t,function(n){return n.connectionID==i}),n!=null&&n!=undefined&&(n.lastMesage=this.keyonmessage),this.addTalk(this.nowtalkid,this.connectionid,this.keyonmessage),this.keyonmessage="")},addTalk:function(n,t,i){var r=_.find(this.talklist,function(t){return t.talkid==n});r!=null&&r!=undefined?r.talks.push({talkid:t,message:i}):(r={talkid:n,talks:[{talkid:t,message:i}]},this.talklist.push(r));r.talkid==this.nowtalkid&&this.refreshChat()},refreshChat:function(){var t=this,i=this.nowtalkid,n=_.find(this.talklist,function(n){return n.talkid==i});this.nowtalk=n!=null&&n!=undefined?_.cloneDeep(n.talks):[];this.$nextTick(function(){t.autoScrollToBottom()})},autoScrollToBottom:function(){var n=this.$refs.scrollContainer;n.scrollHeight!=undefined&&(n.scrollTop=n.scrollHeight)},isWhiteSpace:function(n){return/^\s*$/.test(n)}}}).mount("#app");